<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pro Meme Generator</title>
<style>
  :root {
    --bg: #0a1f3d;
    --card: rgba(10,31,61,0.8);
    --accent: #1DA1F2;
    --glass: rgba(255,255,255,0.05);
    --muted: #d1eaff;
  }
  body {
    margin: 0;
    font-family: 'Arial', sans-serif;
    background: var(--bg);
    color: white;
    display: flex;
    height: 100vh;
    overflow: hidden;
  }
  #sidebar {
    width: 250px;
    background: var(--card);
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    overflow-y: auto;
  }
  #canvas-container {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    background: #0d284d;
  }
  canvas {
    background: #fff;
    max-width: 90%;
    max-height: 90%;
    box-shadow: 0 0 20px var(--accent);
    border-radius: 10px;
  }
  input, button, select {
    padding: 8px;
    border-radius: 5px;
    border: none;
    outline: none;
    font-size: 14px;
  }
  button {
    background: var(--accent);
    color: white;
    cursor: pointer;
  }
  button:hover { opacity: 0.85; }
</style>
</head>
<body>

<div id="sidebar">
  <h2>Meme Tools</h2>
  <input type="text" id="text-input" placeholder="Add text here">
  <button id="add-text">Add Text</button>

  <h3>Text Color</h3>
  <input type="color" id="text-color" value="#1DA1F2">

  <h3>Font Size</h3>
  <input type="number" id="font-size" value="40" min="10" max="200">

  <h3>Stickers</h3>
  <button onclick="addEmoji('ðŸ”¥')">ðŸ”¥</button>
  <button onclick="addEmoji('ðŸ˜‚')">ðŸ˜‚</button>
  <button onclick="addEmoji('ðŸš€')">ðŸš€</button>
  <input type="file" id="sticker-upload" accept="image/*">

  <h3>Actions</h3>
  <button id="download">Download Meme</button>
</div>

<div id="canvas-container">
  <canvas id="meme-canvas" width="800" height="600"></canvas>
</div>

<script>
const canvas = document.getElementById('meme-canvas');
const ctx = canvas.getContext('2d');

let logoImg = new Image();
logoImg.src = 'https://pbs.twimg.com/profile_images/1950265537784926208/qbjSWMDP_400x400.jpg';

let layers = [];

function uid(){ return '_' + Math.random().toString(36).substr(2, 9); }

// --- Render ---
function clearCanvas(){ ctx.clearRect(0,0,canvas.width,canvas.height); }

function drawLogo(){
    if(logoImg.complete) ctx.drawImage(logoImg, 20, 20, 80, 80);
}

function drawLayers(){
    layers.forEach(layer => {
        ctx.save();
        ctx.translate(layer.x, layer.y);
        ctx.rotate(layer.rotate || 0);
        ctx.globalAlpha = layer.opacity || 1;
        if(layer.type === 'text'){
            ctx.fillStyle = layer.color;
            ctx.font = `${layer.size}px Arial`;
            ctx.textAlign = 'center';
            ctx.fillText(layer.text,0,0);
        }
        if(layer.type === 'emoji'){
            ctx.font = `${layer.size}px Arial`;
            ctx.textAlign = 'center';
            ctx.fillText(layer.emoji,0,0);
        }
        if(layer.type === 'stickerImage' && layer.img){
            ctx.drawImage(layer.img, -layer.w/2, -layer.h/2, layer.w, layer.h);
        }
        ctx.restore();
    });
}

function render(){
    clearCanvas();
    drawLogo();
    drawLayers();
}

// --- Add Text ---
document.getElementById('add-text').addEventListener('click', ()=>{
    const txt = document.getElementById('text-input').value;
    if(!txt) return;
    layers.push({
        id: uid(),
        type: 'text',
        text: txt,
        x: canvas.width/2,
        y: canvas.height/2,
        size: parseInt(document.getElementById('font-size').value),
        color: document.getElementById('text-color').value,
        rotate: 0,
        opacity:1
    });
    render();
});

// --- Add Emoji ---
function addEmoji(e){
    layers.push({
        id: uid(),
        type: 'emoji',
        emoji: e,
        x: canvas.width/2,
        y: canvas.height/2,
        size: 60,
        rotate: 0,
        opacity:1
    });
    render();
}

// --- Add Sticker Image ---
document.getElementById('sticker-upload').addEventListener('change', (e)=>{
    const file = e.target.files[0];
    if(!file) return;
    const img = new Image();
    img.src = URL.createObjectURL(file);
    img.onload = ()=>{
        layers.push({
            id: uid(),
            type: 'stickerImage',
            img,
            x: canvas.width/2,
            y: canvas.height/2,
            w: img.width/2,
            h: img.height/2,
            rotate:0,
            opacity:1
        });
        render();
    }
});

// --- Drag & Drop ---
let selectedLayer = null;
let offsetX, offsetY;

canvas.addEventListener('mousedown', (e)=>{
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;

    selectedLayer = layers.slice().reverse().find(layer=>{
        let lx = layer.x, ly = layer.y, size = layer.size || layer.w || 50;
        return Math.abs(mx-lx) < size && Math.abs(my-ly) < size;
    });
    if(selectedLayer){
        offsetX = mx - selectedLayer.x;
        offsetY = my - selectedLayer.y;
    }
});

canvas.addEventListener('mousemove', (e)=>{
    if(!selectedLayer) return;
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;
    selectedLayer.x = mx - offsetX;
    selectedLayer.y = my - offsetY;
    render();
});

canvas.addEventListener('mouseup', ()=>{ selectedLayer=null; });
canvas.addEventListener('mouseleave', ()=>{ selectedLayer=null; });

// --- Download ---
document.getElementById('download').addEventListener('click', ()=>{
    const link = document.createElement('a');
    link.download = 'meme.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
});

logoImg.onload = render;
</script>
</body>
</html>

