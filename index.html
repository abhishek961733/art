<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>15-piece Rialo Puzzle</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#07102a;color:#e6eef8;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:20px}
h1{margin-bottom:12px;text-align:center}
#controls{display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap;justify-content:center}
button,select{padding:8px 12px;border:none;border-radius:6px;background:#2563eb;color:#fff;cursor:pointer;font-weight:600}
#board{position:relative;width:620px;height:620px;background:#02102b;border-radius:12px;overflow:hidden;touch-action:none}
.piece{position:absolute;cursor:grab;transition:all 0.2s ease;will-change:transform}
.piece.selected{outline:3px solid rgba(37,99,235,0.5);transform:scale(1.05)}
#info{margin-top:10px;font-size:13px;text-align:center}
</style>
</head>
<body>

<h1>Rialo 15-piece Puzzle</h1>
<div id="controls">
  <select id="shuffleCount"><option value="20">Easy Shuffle</option><option value="40" selected>Medium Shuffle</option><option value="80">Hard Shuffle</option></select>
  <button id="create">Create & Shuffle</button>
  <button id="reshuffle">Reshuffle</button>
  <button id="solve">Show Solution</button>
  <button id="hint">Hint</button>
</div>
<div id="board"></div>
<div id="info">Moves: <span id="moves">0</span> Â· Solved: <span id="solved">No</span></div>

<script>
const IMAGE_SRC='https://pbs.twimg.com/profile_images/1950265537784926208/qbjSWMDP_400x400.jpg';
const PIECE_COUNT=15;
const board=document.getElementById('board');
const createBtn=document.getElementById('create');
const reshuffleBtn=document.getElementById('reshuffle');
const solveBtn=document.getElementById('solve');
const hintBtn=document.getElementById('hint');
const shuffleCountSelect=document.getElementById('shuffleCount');
const movesSpan=document.getElementById('moves');
const solvedSpan=document.getElementById('solved');

let img=new Image();
img.crossOrigin='anonymous';
img.src=IMAGE_SRC;

let pieces=[],selectedPiece=null,moves=0;

function resetState(){pieces=[];selectedPiece=null;moves=0;movesSpan.textContent='0';solvedSpan.textContent='No';board.innerHTML='';}

function createPieces(){
  resetState();
  const boardSize=board.clientWidth;
  const canvas=document.createElement('canvas');
  canvas.width=boardSize;canvas.height=boardSize;
  const ctx=canvas.getContext('2d');
  ctx.drawImage(img,0,0,img.naturalWidth,img.naturalHeight,0,0,boardSize,boardSize);

  // generate 15 vertical slices
  const sliceHeights=[];
  for(let i=0;i<PIECE_COUNT;i++) sliceHeights.push(Math.floor(boardSize/PIECE_COUNT));
  sliceHeights[PIECE_COUNT-1]=boardSize-sliceHeights.slice(0,PIECE_COUNT-1).reduce((a,b)=>a+b,0);

  let yAccum=0;
  for(let i=0;i<PIECE_COUNT;i++){
    const pieceCanvas=document.createElement('canvas');
    pieceCanvas.width=boardSize;pieceCanvas.height=sliceHeights[i];
    const pieceCtx=pieceCanvas.getContext('2d');
    pieceCtx.drawImage(canvas,0,yAccum,boardSize,sliceHeights[i],0,0,boardSize,sliceHeights[i]);
    const dataURL=pieceCanvas.toDataURL();

    const pieceEl=document.createElement('div');
    pieceEl.className='piece';
    pieceEl.style.width=boardSize+'px';
    pieceEl.style.height=sliceHeights[i]+'px';
    pieceEl.style.left=Math.random()*(boardSize-50)+'px';
    pieceEl.style.top=Math.random()*(boardSize-50)+'px';
    pieceEl.dataset.correctIndex=i;

    // Apply Rialo SVG clipPath (approximate kite/diamond shape)
    const svgNS="http://www.w3.org/2000/svg";
    const svg=document.createElementNS(svgNS,'svg');
    svg.setAttribute('width','0');svg.setAttribute('height','0');
    const clipPath=document.createElementNS(svgNS,'clipPath');
    clipPath.setAttribute('id','clip-'+i);
    const path=document.createElementNS(svgNS,'path');
    path.setAttribute('d','M310,0 L620,310 L310,620 L0,310 Z'); // diamond/kite shape
    clipPath.appendChild(path);svg.appendChild(clipPath);
    document.body.appendChild(svg);
    pieceEl.style.clipPath='url(#clip-'+i+')';
    pieceEl.style.backgroundImage=`url(${dataURL})`;
    pieceEl.style.backgroundSize='cover';
    pieceEl.style.backgroundPosition='center';

    board.appendChild(pieceEl);
    pieces.push({id:i,correctIndex:i,currentIndex:i,el:pieceEl,yPos:yAccum,height:sliceHeights[i]});
    attachInteractions(pieceEl);
    yAccum+=sliceHeights[i];
  }
  shufflePieces(parseInt(shuffleCountSelect.value,10));
  updateSolvedStatus();
}

function attachInteractions(el){
  el.addEventListener('click',()=>{onPieceSelect(el)});
  // basic drag for mobile
  let dragging=false,startX=0,startY=0,origX=0,origY=0;
  el.addEventListener('mousedown',(e)=>{
    e.preventDefault();dragging=true;startX=e.clientX;startY=e.clientY;origX=parseInt(el.style.left);origY=parseInt(el.style.top);el.style.zIndex=999;
    const onMove=(ev)=>{if(dragging){el.style.left=origX+ev.clientX-startX+'px';el.style.top=origY+ev.clientY-startY+'px';}};
    const onUp=(ev)=>{if(dragging){dragging=false;el.style.zIndex='';swapNearest(el);window.removeEventListener('mousemove',onMove);window.removeEventListener('mouseup',onUp);}};
    window.addEventListener('mousemove',onMove);window.addEventListener('mouseup',onUp);
  });
}

function onPieceSelect(el){
  if(!selectedPiece){selectedPiece=el;el.classList.add('selected');return;}
  if(selectedPiece===el){selectedPiece.classList.remove('selected');selectedPiece=null;return;}
  swapByElements(selectedPiece,el);selectedPiece.classList.remove('selected');selectedPiece=null;
}

function swapByElements(a,b){
  const pa=pieces.find(p=>p.el===a);const pb=pieces.find(p=>p.el===b);
  const tmpLeft=a.style.left,tmpTop=a.style.top;
  a.style.left=b.style.left;a.style.top=b.style.top;
  b.style.left=tmpLeft;b.style.top=tmpTop;
  const tmpIdx=pa.currentIndex;pa.currentIndex=pb.currentIndex;pb.currentIndex=tmpIdx;
  moves++;movesSpan.textContent=moves;
  updateSolvedStatus();
}

function swapNearest(el){
  const elRect=el.getBoundingClientRect();
  const elCenterX=elRect.left+elRect.width/2,elCenterY=elRect.top+elRect.height/2;
  let nearest=null,minDist=Infinity;
  pieces.forEach(p=>{if(p.el!==el){const r=p.el.getBoundingClientRect();const cx=r.left+r.width/2,cy=r.top+r.height/2;const d=Math.hypot(cx-elCenterX,cy-elCenterY);if(d<minDist){minDist=d;nearest=p.el;}}});
  if(nearest&&minDist<120) swapByElements(el,nearest);
}

function shufflePieces(times=40){
  for(let i=0;i<times;i++){
    const a=pieces[Math.floor(Math.random()*pieces.length)];
    const b=pieces[Math.floor(Math.random()*pieces.length)];
    if(a===b) continue;
    const tmpX=a.el.style.left,tmpY=a.el.style.top;
    a.el.style.left=b.el.style.left;a.el.style.top=b.el.style.top;
    b.el.style.left=tmpX;b.el.style.top=tmpY;
    const tmpIdx=a.currentIndex;a.currentIndex=b.currentIndex;b.currentIndex=tmpIdx;
  }
  moves=0;movesSpan.textContent='0';
}

function updateSolvedStatus(){
  const ok=pieces.every(p=>p.currentIndex===p.correctIndex);
  solvedSpan.textContent=ok?'Yes':'No';
  if(ok){board.style.boxShadow='0 0 40px #2563eb,0 0 80px #38bdf8';setTimeout(()=>board.style.boxShadow='',1200);}
}

// controls
createBtn.addEventListener('click',()=>{if(!img.complete){alert('Image loading...');return;}createPieces();});
reshuffleBtn.addEventListener('click',()=>{shufflePieces(parseInt(shuffleCountSelect.value,10));});
solveBtn.addEventListener('click',()=>{pieces.forEach(p=>{p.currentIndex=p.correctIndex;p.el.style.left='0px';p.el.style.top=(p.yPos)+'px';});moves=0;movesSpan.textContent='0';updateSolvedStatus();});
hintBtn.addEventListener('click',()=>{const wrong=pieces.filter(p=>p.currentIndex!==p.correctIndex);if(wrong.length>0){const p=wrong[0];p.el.style.outline='3px solid #38bdf8';setTimeout(()=>{p.el.style.outline='';},1500);}});

</script>
</body>
</html>
