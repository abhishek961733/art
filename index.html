<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rialo Meme Tool</title>
<style>
:root {
  --bg: #0a1f3d;
  --card: rgba(10,31,61,0.8);
  --accent: #1DA1F2;
  --glass: rgba(255,255,255,0.05);
  --muted: #d1eaff;
}
body{
  margin:0; font-family: Arial, sans-serif;
  display:flex; height:100vh; background:var(--bg); color:white; overflow:hidden;
}
#sidebar{
  width:300px; background:var(--card); padding:15px; display:flex; flex-direction:column; gap:15px; overflow-y:auto;
}
#canvas-container{
  flex:1; display:flex; justify-content:center; align-items:center; background:#0d284d; position:relative;
}
canvas{
  background:#fff; max-width:90%; max-height:90%; box-shadow:0 0 25px var(--accent); border-radius:12px;
  cursor:pointer;
}
button,input,select{padding:8px; border-radius:5px; border:none; outline:none; font-size:14px;}
button{background:var(--accent); color:white; cursor:pointer;}
button:hover{opacity:0.85;}
h2,h3{margin:5px 0;}
.sticker-btn{padding:5px; margin:2px; font-size:20px; cursor:pointer;}
</style>
</head>
<body>

<div id="sidebar">
  <h2>Rialo Meme Tool</h2>
  <input type="text" id="text-input" placeholder="Add text">
  <button id="add-text">Add Text</button>
  <h3>Text Color</h3>
  <input type="color" id="text-color" value="#1DA1F2">
  <h3>Font Size</h3>
  <input type="number" id="font-size" value="40" min="10" max="200">
  
  <h3>Emojis</h3>
  <div>
    <span class="sticker-btn" onclick="addEmoji('ğŸ”¥')">ğŸ”¥</span>
    <span class="sticker-btn" onclick="addEmoji('ğŸ˜‚')">ğŸ˜‚</span>
    <span class="sticker-btn" onclick="addEmoji('ğŸš€')">ğŸš€</span>
    <span class="sticker-btn" onclick="addEmoji('ğŸ’€')">ğŸ’€</span>
    <span class="sticker-btn" onclick="addEmoji('ğŸ¸')">ğŸ¸</span>
    <span class="sticker-btn" onclick="addEmoji('ğŸ¤£')">ğŸ¤£</span>
    <span class="sticker-btn" onclick="addEmoji('ğŸ¥µ')">ğŸ¥µ</span>
    <span class="sticker-btn" onclick="addEmoji('ğŸ¥¶')">ğŸ¥¶</span>
    <span class="sticker-btn" onclick="addEmoji('ğŸ‘€')">ğŸ‘€</span>
    <span class="sticker-btn" onclick="addEmoji('ğŸ’¥')">ğŸ’¥</span>
  </div>
  
  <h3>PNG Stickers</h3>
  <input type="file" id="sticker-upload" accept="image/*">

  <h3>Actions</h3>
  <button id="download">Download Meme</button>
</div>

<div id="canvas-container">
  <canvas id="meme-canvas" width="800" height="600"></canvas>
</div>

<script>
const canvas = document.getElementById('meme-canvas');
const ctx = canvas.getContext('2d');

let logoImg = new Image();
logoImg.src = 'https://pbs.twimg.com/profile_images/1950265537784926208/qbjSWMDP_400x400.jpg';

let layers = [];
let selectedLayer = null;
let offsetX, offsetY;
let isResizing = false;

// --- Utility ---
function uid(){ return '_' + Math.random().toString(36).substr(2,9); }

// --- Render ---
function clearCanvas(){ ctx.clearRect(0,0,canvas.width,canvas.height); }

function drawLogo(){
    if(logoImg.complete) ctx.drawImage(logoImg, 20,20,80,80);
}

function drawLayers(){
    layers.forEach(layer=>{
        ctx.save();
        ctx.translate(layer.x,layer.y);
        ctx.rotate(layer.rotate || 0);
        ctx.globalAlpha = layer.opacity || 1;
        if(layer.type==='text'){
            ctx.fillStyle=layer.color;
            ctx.font = `${layer.size}px Arial`;
            ctx.textAlign='center';
            ctx.fillText(layer.text,0,0);
        }
        if(layer.type==='emoji'){
            ctx.font = `${layer.size}px Arial`;
            ctx.textAlign='center';
            ctx.fillText(layer.emoji,0,0);
        }
        if(layer.type==='stickerImage' && layer.img){
            ctx.drawImage(layer.img,-layer.w/2,-layer.h/2,layer.w,layer.h);
        }
        ctx.restore();
    });
}

function render(){
    clearCanvas();
    drawLogo();
    drawLayers();
}

// --- Add Text ---
document.getElementById('add-text').addEventListener('click',()=>{
    const txt=document.getElementById('text-input').value;
    if(!txt) return;
    layers.push({
        id: uid(),
        type: 'text',
        text: txt,
        x: canvas.width/2,
        y: canvas.height/2,
        size: parseInt(document.getElementById('font-size').value),
        color: document.getElementById('text-color').value,
        rotate: 0,
        opacity: 1
    });
    render();
});

// --- Add Emoji ---
function addEmoji(e){
    layers.push({
        id: uid(),
        type: 'emoji',
        emoji: e,
        x: canvas.width/2,
        y: canvas.height/2,
        size: 60,
        rotate: 0,
        opacity:1
    });
    render();
}

// --- Add Sticker Image ---
document.getElementById('sticker-upload').addEventListener('change', (e)=>{
    const file = e.target.files[0];
    if(!file) return;
    const img = new Image();
    img.src = URL.createObjectURL(file);
    img.onload = ()=>{
        layers.push({
            id: uid(),
            type: 'stickerImage',
            img,
            x: canvas.width/2,
            y: canvas.height/2,
            w: img.width/2,
            h: img.height/2,
            rotate:0,
            opacity:1
        });
        render();
    }
});

// --- Drag & Resize ---
canvas.addEventListener('mousedown',(e)=>{
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;
    selectedLayer = layers.slice().reverse().find(layer=>{
        let lx = layer.x, ly = layer.y, size = layer.size || layer.w || 50;
        return Math.abs(mx-lx)<size && Math.abs(my-ly)<size;
    });
    if(selectedLayer){
        offsetX = mx - selectedLayer.x;
        offsetY = my - selectedLayer.y;
        if(e.shiftKey) isResizing = true; else isResizing = false;
    }
});

canvas.addEventListener('mousemove',(e)=>{
    if(!selectedLayer) return;
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;
    if(isResizing){
        if(selectedLayer.type==='text' || selectedLayer.type==='emoji') selectedLayer.size = Math.max(10,my - selectedLayer.y);
        if(selectedLayer.type==='stickerImage'){ selectedLayer.w = Math.max(20,mx - selectedLayer.x + selectedLayer.w/2); selectedLayer.h = Math.max(20,my - selectedLayer.y + selectedLayer.h/2);}
    } else {
        selectedLayer.x = mx - offsetX;
        selectedLayer.y = my - offsetY;
    }
    render();
});

canvas.addEventListener('mouseup',()=>{ selectedLayer=null; });
canvas.addEventListener('mouseleave',()=>{ selectedLayer=null; });

// --- Download ---
document.getElementById('download').addEventListener('click',()=>{
    const link = document.createElement('a');
    link.download = 'rialo_meme.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
});

logoImg.onload = render;
</script>

</body>
</html>
